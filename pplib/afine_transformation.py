# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# File name: afine_transformation.py
# Created by: gemusia
# Creation date: 20-01-2018
# Last modified: 21-01-2018 21:56:47
# Purpose: 
#
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


import numpy as np

Ufx = np.array([ 0.020883 ,  0.021884 ,  0.036644 ,  0.025015 ,  0.031795 ,
       -0.013087 , -0.017833 , -0.010748 , -0.01598  , -0.025252 ,
       -0.029198 ,  0.015406 , -0.0037895,  0.012066 ,  0.0084922,
       -0.022047 , -0.0069716,  0.010472 ,  0.0055341, -0.011386 ,
       -0.0071907,  0.0072798, -0.013713 , -0.028218 , -0.007487 ,
       -0.018993 , -0.013928 ,  0.012961 ,  0.014386 ,  0.0098586,
       -0.0049017,  0.011529 ])

Ux = np.array([ 0.010456  ,  0.016766  ,  0.028213  ,  0.030915  ,  0.023598  ,
        0.018541  ,  0.022338  ,  0.032532  ,  0.046086  ,  0.052497  ,
        0.033406  ,  0.010971  ,  0.017257  ,  0.028129  ,  0.03444   ,
        0.038584  ,  0.035648  ,  0.026684  ,  0.015635  ,  0.0034943 ,
       -0.014758  , -0.028788  , -0.027637  , -0.024922  , -0.021698  ,
       -0.017567  , -0.0086551 , -0.00042793, -0.00034159, -0.0080953 ,
       -0.013032  , -0.035006  , -0.033873  , -0.0097744 ,  0.00014538,
       -0.010529  , -0.021898  , -0.033015  , -0.037384  , -0.039061  ,
       -0.047662  , -0.052705  ,  0.010853  ,  0.059294  ,  0.029961  ,
        0.0041287 , -0.0055867 , -0.0080131 , -0.0070568 , -0.0030375 ,
        0.0029349 ,  0.0076756 ,  0.017097  ,  0.022855  ,  0.017541  ,
        0.0061875 ,  0.0041762 ,  0.0052054 , -0.0038808 , -0.018172  ,
       -0.012015  , -0.020332  , -0.034864  , -0.043307  , -0.0099216 ,
        0.024673  ,  0.020278  ,  0.017703  ,  0.0039129 , -0.00036879,
        0.0017766 ,  0.007711  ,  0.010874  ,  0.0069801 ,  0.00089039,
       -0.00064433, -0.013879  , -0.020836  , -0.024862  , -0.01705   ,
       -0.0064518 ,  0.0039027 ,  0.0076543 ,  0.011447  ,  0.011387  ,
        0.0040348 , -0.0031128 , -0.01177   , -0.019913  , -0.019688  ,
       -0.017569  , -0.017869  , -0.024573  , -0.038373  , -0.043589  ,
       -0.020853  ,  0.0079963 ,  0.011965  ,  0.0032456 , -0.010713  ,
       -0.027428  , -0.04607   , -0.044556  , -0.0031629 ,  0.0041793 ,
       -0.0025509 , -0.0061638 ,  0.0051976 ,  0.012456  ,  0.016649  ,
        0.017583  ,  0.017353  ,  0.017582  ,  0.01454   ,  0.010906  ,
        0.010808  ,  0.011209  ,  0.0086796 ,  0.0029279 ,  0.005537  ,
       -0.0054026 , -0.023176  , -0.0092315 ,  0.010115  ,  0.024509  ,
        0.025849  ,  0.020879  ,  0.011305  ])

def u0(U):
    def u0xi(xi):
        linear_xi =(U[2:]-U[:-2])*xi+ U[:-2]
        return linear_xi
    return u0xi


def w(U,d1,d2):

    def q1(xi):
        linear_xi =(U[1:-1]-U[:-2] + d1*(U[2:]-U[:-2]))*xi+ U[:-2]*(1-d1)
        return linear_xi

    def q2(xi):
        linear_xi =(U[2:]-U[1:-1] + d1*(U[2:]-U[:-2]))*xi+ U[1:-1]*(1-d2)
        return linear_xi

    def w_recursive(u0,n):
        def w_xi(xi):
            if xi>=0 and xi<0.5:
                value = d1*ui(2*xi) + q1(2*xi)   
                return value
            elif xi>=0.5 and xi<=1:
                value = d2*ui(2*xi-1) + q2(2*xi-1)   
                return value
            else:
                raise ValueError("xi is not in range [0,1]:", xi)
        return w_xi

        if n==0:
            return ui 
        else:
            return w_recursive(w_xi,n-1)
    return w_recursive        

